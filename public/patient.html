<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Patient - Medical Records Viewer</title>
  </head>
  <body>
    <h1>Patient Portal</h1>

    <h2>Create Patient</h2>
    <form id="createPatient">
      <label>Name: <input name="name" required /></label><br />
      <label>DOB: <input name="dob" type="date" required/></label><br />
      <button>Create</button>
    </form>
    <pre id="patientResult"></pre>

    <h2>Record a Condition</h2>
    <form id="createRecord">
      <label>Patient ID: <input name="patientId" required /></label><br />
      <label>Conditions (comma): <input name="conditions" required /></label><br />
      <button>Save Record</button>
    </form>
    <pre id="recordResult"></pre>

    <h2>View My Records</h2>
    <form id="viewRecords">
      <label>Patient ID: <input name="patientId" required /></label>
      <button>View</button>
    </form>
    <pre id="viewResult"></pre>

    <script>
      document.getElementById('createPatient').addEventListener('submit', async e=>{
        e.preventDefault();
        const f = e.target;
        const res = await fetch('/api/patients', {method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({name:f.name.value,dob:f.dob.value})});
        document.getElementById('patientResult').textContent = await res.text();
      });

      document.getElementById('createRecord').addEventListener('submit', async e=>{
        e.preventDefault();
        const f = e.target;
        const conds = f.conditions.value.split(',').map(s=>s.trim()).filter(Boolean);
        const res = await fetch('/api/records', {method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({patientId:f.patientId.value,conditions:conds})});
        document.getElementById('recordResult').textContent = await res.text();
      });

      document.getElementById('viewRecords').addEventListener('submit', async e=>{
        e.preventDefault();
        const id = e.target.patientId.value;
        const res = await fetch(`/api/patients/${encodeURIComponent(id)}`);
        document.getElementById('viewResult').textContent = JSON.stringify(await res.json(), null, 2);
      });
    </script>
  </body>
</html>
